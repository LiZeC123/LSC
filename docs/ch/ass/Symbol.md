代码生成与符号管理
===============


符号表管理
-----------

相比于编译器的设计,汇编器的符号表管理既有相似的部分,也存在一些差异. 

#### 汇编语言的四种符号
1. 数据
    - 表示一段内存区域的起始位置,一般保存在数据段
    - 这些数据对应于高级语言中的全局变量(数组)或者常量
2. 标签
    - 表示一个内存地址,一般存在于代码段
    - 可能来自于高级语言的函数名或者翻译符合语句时产生
3. 宏
    - 表示一个立即数,相当于给一个数字常量起了一个名字
4. 外部符号
    - 表示引用其他文件的数据或标签,一般表示一个外部全局变量

#### 汇编语言的符号添加
相比于高级语言中变量一定先声明后使用,汇编语言并不要求先声明符号,因此如果仅仅是按照顺序扫描文件,有些符号会在声明之前先被使用. 所以需要对汇编语言的源文件扫描两次.

第一次扫描时,把当时还不存在的符号先当作外部符号存入符号表,在后续读取到符号声明后再覆盖之前的声明.

由于全局符号的声明方式,有两次声明过程,例如
``` assembly
global main
main:
	push ebp
	mov ebp,esp
	sub esp,4
	mov eax,@L2
    ...
```

在上述的汇编代码中,main先用global关键字声明了一次,后续直接使用. 由于普通的标签直接出现就是声明方式,因此上述语句相当于对mian声明了两次. 由于汇编代码来自前一阶段编译器,因此除了上述这种情况以外,并不会出现同名变量的两次声明. 所以出于程序的简便性,在添加符号到符号表时,对符号进行一点额外的检查,即
1. 如果加入的符号不再符号表中,则直接存入符号
2. 否则判断符号表中的符号是否有个global属性
    - 如果有,则将global属性继承给新的符号
    - 最后使用新符号覆盖原有符号

